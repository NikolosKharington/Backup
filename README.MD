# Домашнее задание к занятию «Резервное копирование баз данных»  - Харьков Никита             

### Задание 1 Резервное копирование



### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

---

---
### Решение 1

### 1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день

В данном случае подходит **полное резервное копирование (Full backup)**.

Полное резервное копирование создаёт полную копию набора исходных данных.  
Копируется весь каталог с файлами базы данных либо создаётся образ диска или системы, где находится БД.

Для восстановления данных за предыдущий день достаточно развернуть последнюю полную резервную копию.

---
### 1.2. Необходимо восстанавливать данные за час до предполагаемой поломки

Для этого случая используется **полное резервное копирование в сочетании с инкрементными бэкапами**.

Инкрементное резервное копирование сохраняет только те блоки данных, которые были изменены с момента последнего резервного задания.  
Сначала выполняется восстановление полной копии, затем применяются инкрементные изменения до нужного момента времени.

Такой подход позволяет восстановить базу данных максимально близко к моменту сбоя.

---
### 1.3. Возможен ли кейс с моментальным переключением на работающую базу данных

Да, такой кейс возможен и реализуется с помощью **репликации**.

Репликация основана на том, что помимо главного сервера (мастера) постоянно работают ведомые серверы (слейвы), которые получают инкрементные бэкапы в режиме реального времени.

В случае сбоя мастера один из слейвов может быть назначен новым мастером, а клиенты перенаправлены на него.  
Таким образом достигается высокая доступность и минимальное время простоя.

---
### Задание 2 PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

---
### Решение 2

### 2.1. Пример резервного копирования и восстановления PostgreSQL

В PostgreSQL резервное копирование может выполняться путём генерации SQL-файла с командами, которые позволяют пересоздать базу данных.

**Резервное копирование базы данных:**

pg_dump my_database > backup.sql
Восстановление базы данных:

psql my_database < backup.sql

---

2.1.* Возможна ли автоматизация резервного копирования

Да, процесс резервного копирования можно автоматизировать. Для этого используются:

- **скрипты**;
- **планировщик заданий `cron`**.

Резервные копии могут создаваться по расписанию, например ежедневно или ежечасно, без участия администратора.

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---

### Решение 3

#### 3.1. Пример инкрементного резервного копирования MySQL

В MySQL инкрементное резервное копирование реализуется с использованием **бинарных логов (binlog)**.

Сначала создаётся полная резервная копия базы данных, после чего все изменения сохраняются в бинарных логах.

Пример создания полной резервной копии:

mysqldump my_database > full_backup.sql

---

#### 3.1.* В каких случаях использование реплики даёт преимущество

- требуется высокая доступность и быстрое переключение при сбое;
- нужно уменьшить простой;
- можно разгрузить мастер, отдавая чтение (SELECT) на реплику.

> Реплика — это не резервная копия, а дополнение к бэкапам.
